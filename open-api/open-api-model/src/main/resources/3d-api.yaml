---
openapi: 3.0.0
info:
  title: Pack API reference
  description: |
    Pack boxes into containers
  version: 1.0.0
paths:
  /pack:
    post:
      summary: Perform a packaging operation
      description: |
        Pack an order
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/PackRequest"
      responses:
        "200":
          description: Pack response
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/PackResponse"

components:
  schemas:
    Surface:
      type: string
      enum:
        - front
        - frontAtZeroDegrees
        - frontAtNinetyDegrees
        - rear
        - rearAtZeroDegrees
        - rearAtNinetyDegrees
        - left
        - leftAtZeroDegrees
        - leftAtNinetyDegrees
        - right
        - rightAtZeroDegrees
        - rightAtNinetyDegrees
        - top
        - topAtZeroDegrees
        - topAtNinetyDegrees
        - bottom
        - bottomAtZeroDegrees
        - bottomAtNinetyDegrees
        - all

    PackedContainer:
      type: object
      properties:
        id:
          type: string
        weight:
          type: integer

    PackedBox:
      type: object
      properties:
        id:
          type: string
        x:
          type: integer
        y:
          type: integer
        z:
          type: integer
        surface:
          $ref: '#/components/schemas/Surface'

    Box:
      type: object
      properties:
        id:
          type: string
        description:
          type: string
        dx:
          type: integer
        dy:
          type: integer
        dz:
          type: integer
        surfaces:
          type: array
          items: 
            $ref: '#/components/schemas/Surface'

    Container:
      type: object
      properties:
        id:
          type: string
        dx:
          type: integer
        dy:
          type: integer
        dz:
          type: integer
        loadDx:
          type: integer
        loadDy:
          type: integer
        loadDz:
          type: integer
        minLoadWeight:
          type: integer
        maxLoadWeight:
          type: integer
        emptyWeight:
          type: integer

    ContainerItem:
      type: object    
      properties:
        container:
          $ref: '#/components/schemas/Container'
        count:
          type: integer
        cost:
          $ref: '#/components/schemas/Cost'

    BoxItem:
      type: object    
      properties:
        box:
          $ref: '#/components/schemas/Box'
        count:
          type: integer

    Packager:
      type: object
      properties:
        id:
          type: string
        resourceLimits:
          type: array
          items:
            $ref: '#/components/schemas/ResourceLimit'
        features:
          type: array
          items:
            $ref: '#/components/schemas/PackagerFeature'
          
    PackResult:
      type: object
      properties:
        container:
          $ref: '#/components/schemas/PackedContainer'
        boxes:
          type: array
          items:
            $ref: '#/components/schemas/PackedBox'

    PackResponse:
      type: object
      properties:
        status:
          type: integer
        results:
          type: array
          items:
            $ref: '#/components/schemas/PackResult'
            
    PackRequest:
      type: object
      properties:
        temporalLimit:
           $ref: '#/components/schemas/TemporalLimit'
        resourceLimits:
          type: array
          items:
            $ref: '#/components/schemas/ResourceLimit'
        maxContainers:
          type: integer
        containerItems:
          type: array
          items:
            $ref: '#/components/schemas/ContainerItem'
        boxItems:
          type: array
          items:
            $ref: '#/components/schemas/BoxItem'
        packagers:
          type: array
          items:
            $ref: '#/components/schemas/Packager'

    TemporalLimit:
      type: object
      properties:
        value:
          type: integer
          format: int64
        type:
          $ref: '#/components/schemas/TemporalLimitType'

    TemporalLimitType:
      type: string
      enum:
        - duration
        - deadline
            
    ResourceLimit:
      type: object
      properties:
        value:
          type: integer
          format: int64
        type:
          $ref: '#/components/schemas/ResourceLimitType'
            
    ResourceLimitType:
      type: string
      enum:
        - CPU_COUNT
        - CPU_TIME
        - CPU_COST

    PackagerFeature:
      type: object
      properties:
        name: 
          type: string

    Cost:
      type: object
      discriminator:
        propertyName: type
        mapping:
          fixed: "#/components/schemas/FixedCost"
          weight: "#/components/schemas/WeightCost"
          volume: "#/components/schemas/VolumeCost"
          composite: "#/components/schemas/CompositeCost"
      properties:
        name: 
          type: string

    CompositeCost:
      allOf:
        - $ref: "#/components/schemas/Cost"
        - type: object    
          properties:
            operator:
                $ref: '#/components/schemas/CompositeCostOperator'      
            costs:
              type: array
              items:
                $ref: '#/components/schemas/Cost'

    FixedCost:
      allOf:
        - $ref: "#/components/schemas/Cost"
        - type: object    
          properties:
            value:
              type: integer
              format: int64

    WeightCost:
      allOf:
        - $ref: "#/components/schemas/Cost"
        - type: object    
          properties:
            value:
              type: integer
              format: int64
            quantity:
              type: integer
              format: int64

    VolumeCost:
      allOf:
        - $ref: "#/components/schemas/Cost"
        - type: object    
          properties:
            value:
              type: integer
              format: int64
            quantity:
              type: integer
              format: int64

    CompositeCostOperator:
      type: string
      enum:
        - MAX
        - MIN
        - SUM






